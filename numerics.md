# 数值行为与可重复性说明（NUMERICS）

> 本文档用于说明本项目中 **自研稀疏线性方程组求解器**
> 在数值计算方面的行为、假设、边界条件与已知限制。
> 
> 目标读者包括：
> 
> - 使用本求解器进行工程或科研计算的用户
> - 对算法可靠性与可重复性有要求的审稿人
> - 项目长期维护者

---

## 1. 求解问题与算法范围

本项目求解如下形式的线性方程组：

\[
Ax = b
\]

其中：

- \( A \) 为稀疏矩阵
- \( b \) 为已知向量
- \( x \) 为待求解向量

本项目采用 **自研的改进 LU 分解法**，目标在于：

- 在受控假设下提供稳定、可预测的数值行为
- 避免对大型第三方数值库的强依赖
- 明确算法适用范围与失败模式

本求解器 **不以“通用最强鲁棒性”为目标**，
而强调 **数值透明性与可解释性**。

---

## 2. 浮点模型与数值精度

### 2.1 浮点精度

- 默认精度：**双精度浮点（IEEE 754，real64）**
- 不支持单精度求解
- 不支持混合精度策略

所有数值描述均基于 **IEEE 754 双精度算术模型**。

---

### 2.2 舍入与累加行为

- 未使用补偿求和（如 Kahan Summation）
- 累加顺序由算法与稀疏结构决定
- 不同编译器或优化级别下，可能出现末位差异

在正常条件下，这类差异预计处于：

\[
10^{-12} \sim 10^{-14}
\]

数量级，不影响求解有效性判断。

---

## 3. 稀疏矩阵表示与假设

### 3.1 存储格式

- 内部存储格式：**CSR（Compressed Sparse Row）**
- 索引方式：**Fortran 原生 1-based**
- 不允许重复非零项

输入矩阵需在进入求解器前完成装配与规整。

---

### 3.2 结构性假设

除非明确说明，本求解器 **不自动**：

- 检测或强制对称性
- 保证对角占优
- 进行图重排序（如 RCM、AMD）

任何未来引入的结构性自动处理，
均视为 **数值接口变更**，需提升主版本号。

---

## 4. 改进 LU 分解算法说明

### 4.1 基本思想

本项目实现的算法基于经典 LU 分解框架，
并针对稀疏矩阵特点进行了以下改进（示例）：

- 控制性填充（fill-in）策略
- 针对零或弱对角元的预处理修正
- 稀疏访问顺序优化

**具体实现细节以代码为准**，
本文档重点描述数值行为，而非推导过程。

---

### 4.2 Pivot 策略说明

- 默认 **不使用完全主元选取**
- 允许有限形式的局部 pivot（若实现）
- 不保证对任意病态矩阵均可成功分解

当出现以下情况时，分解可能失败：

- 零主元
- 严重病态导致数值不稳定
- 结构性奇异矩阵

---

## 5. 求解流程与数值特征

### 5.1 计算流程

1. 稀疏 LU 分解：\( A \approx LU \)
2. 前代求解：\( Ly = b \)
3. 回代求解：\( Ux = y \)

求解过程中 **不执行迭代修正（iterative refinement）**，
除非在文档或版本说明中明确标出。

---

### 5.2 数值稳定性说明

- 数值稳定性依赖于矩阵条件数与结构
- 对高度不定或病态系统，可能产生较大误差
- 本求解器不会自动检测“结果是否可信”

**用户有责任对结果进行物理或数学一致性验证**。

---

## 6. 终止条件与退出码

CLI 程序定义以下退出码：

| 退出码 | 含义                |
| --- | ----------------- |
| 0   | 成功完成 LU 分解并求解     |
| 3   | 数值失败（零主元 / 分解失败）  |
| 4   | 计算过程中出现 NaN / Inf |

退出码属于 **公共接口的一部分**，
在非主版本升级中不会发生变化。

---

## 7. 确定性与可重复性

### 7.1 确定性条件

在以下条件同时满足时，求解结果是确定性的：

- 单线程执行
- 相同编译器与编译选项
- 相同输入矩阵与参数

在此条件下，结果 **可实现逐位一致（bitwise reproducible）**。

---

### 7.2 非确定性来源

以下因素可能导致末位差异：

- 不同编译器（gfortran / ifort / nvfortran）
- 不同优化级别
- 并行化（若启用）

这些差异通常不影响工程或科学判断。

---

## 8. 回归测试与数值一致性策略

### 8.1 回归测试原则

- 每个发布版本使用固定测试矩阵集
- 参考解由已验证版本生成
- 使用相对误差范数进行比较

判定标准示例：

\[
\frac{\|x_{\text{new}} - x_{\text{ref}}\|_2}
     {\|x_{\text{ref}}\|_2}
< 10^{-10}
\]

---

### 8.2 版本间数值约束

- PATCH 版本：结果必须保持一致
- MINOR 版本：默认行为必须一致
- MAJOR 版本：允许数值行为变化，但需明确说明

---

## 9. 已知限制与不适用场景

本求解器 **不适合用于**：

- 需要强 pivot 或完全主元策略的问题
- 极端病态或高度不定系统
- 对误差界有严格数学保证要求的场景

建议用户在关键应用中：

- 与成熟库进行交叉验证
- 对结果进行独立合理性检查

---

## 10. 数值语义化版本说明

本项目采用 **具有数值含义的语义化版本号**：

- **PATCH**：实现修复，数值结果不变
- **MINOR**：功能扩展，默认数值行为不变
- **MAJOR**：算法或默认数值行为改变

科研或工程使用中，请**始终记录完整版本号**。

---

## 11. 引用与可重复性声明

若在论文或报告中使用本求解器，请注明：

- 项目名称
- 完整版本号
- 本 NUMERICS.md 文档

以确保结果可被独立复现。

---

## 12. 结语

> 数值软件的价值  
> 不在于“总能算出一个结果”，  
> 而在于 **清楚地知道什么时候值得相信它**。

本项目致力于在有限假设下，
提供清晰、稳定、可解释的稀疏 LU 求解能力。
